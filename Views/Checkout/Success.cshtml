@model List<CuaHangBangDiaNhac.Models.Order>
@{
    ViewData["Title"] = "Đặt hàng thành công";
    var isTransfer = ViewBag.PaymentMethod == "Transfer";
    var grandTotal = (decimal)ViewBag.GrandTotal;
    var orderIdsStr = string.Join(", ", Model.Select(o => "#" + o.Id));
    var orderContent = "THANHTOAN " + string.Join(" ", Model.Select(o => o.Id));
    
    // CAU HINH QR CA NHAN
    var qrImagePath = "/images/banking/my-qr.jpg"; 
}

<div class="container py-5">
    <div class="card shadow-sm border-0 mx-auto" style="max-width: 600px;">
        <div class="card-body text-center p-5">
            <div class="mb-4">
                <i class="bi bi-check-circle-fill text-success display-1"></i>
            </div>
            <h2 class="fw-extra-bold text-success mb-3">Đặt hàng thành công!</h2>
            <p class="text-muted mb-4">Cảm ơn bạn đã mua sắm tại cửa hàng. Đơn hàng <strong>@orderIdsStr</strong> của bạn đang được xử lý.</p>

            @if (isTransfer)
            {
                <div class="alert alert-info border-0 bg-light text-dark mb-4">
                    <h5 class="fw-bold mb-3"><i class="bi bi-qr-code me-2"></i>Quét mã để thanh toán</h5>
                    
                    <p class="small text-muted mb-3">
                        Vui lòng quét mã QR bên dưới và nhập đúng <strong>Số tiền</strong> và <strong>Nội dung</strong>.
                    </p>

                    <div class="bg-white p-3 rounded shadow-sm d-inline-block mb-3">
                        <img src="@qrImagePath" alt="Mã QR Cá Nhân" class="img-fluid" style="max-width: 250px;" 
                             onerror="this.src='https://placehold.co/250x250?text=Chua+co+anh+QR';">
                    </div>
                    <div class="text-start px-md-5">
                        <div class="d-flex justify-content-between mb-2 border-bottom pb-2">
                            <span class="text-muted">Số tiền:</span>
                            <span class="fw-extra-bold text-danger">@grandTotal.ToString("N0") ₫</span>
                        </div>
                        <div class="d-flex justify-content-between mb-0">
                            <span class="text-muted">Nội dung chuyển khoản:</span>
                            <span class="fw-bold text-dark copy-text" role="button" onclick="navigator.clipboard.writeText('@orderContent'); Swal.fire('Đã sao chép!', '', 'success')">
                                @orderContent <i class="bi bi-clipboard ms-1"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="mt-3 small text-muted mb-4">
                    * Quét mã trên ứng dụng ngân hàng hoặc Momo/ZaloPay
                </div>
            }
            else
            {
                <div class="alert alert-secondary border-0 mb-4">
                    <i class="bi bi-box-seam me-2"></i>Bạn đã chọn thanh toán khi nhận hàng (COD). Vui lòng chú ý điện thoại khi shipper liên hệ.
                </div>
            }

            <div class="d-grid gap-2 col-md-8 mx-auto">
                <a asp-controller="Home" asp-action="Index" class="btn btn-dark fw-bold py-2">
                    <i class="bi bi-house-door me-2"></i>Quay về trang chủ
                </a>
               <!-- <a asp-controller="Order" asp-action="History" class="btn btn-outline-dark fw-bold py-2">
                    <i class="bi bi-clock-history me-2"></i>Xem lịch sử đơn hàng
                </a> -->
            </div>
        </div>
    </div>
</div>
